---
title: "「算法笔记」欧拉函数、欧拉定理与欧拉降幂公式"
date: 2019-01-30T19:29:20+08:00
showDate: true
tags: ["algorithm", "note"]
---

一些算法题里要求一个数的幂次，一般来说可以大整数+快速幂解决。但有时候数据真的很大，纵是快速幂也奈何不了这道题的。比如某道题要求$2^n$，$n \leq 10^{100000} $，十有八九会TLE。

大多数情况下，这么大的数据都会要求在某个数（通常是$10^9+7$）的模意义下输出答案。事实上，在这样的条件下，题目的用意是使用欧拉降幂公式先降低指数，然后再快速幂求解。

## 欧拉降幂公式

### 定理

$$
a^p \equiv a^{p \bmod \phi(m) + \phi(m)} \pmod m
$$

由于应用为主，证明从略。但显见上式等价于
$$
a^{2\phi(m)} \equiv a^{\phi(m)} \pmod m
$$
其中，$\phi(m)$为欧拉函数。

### 应用

所以，如果题设要求我们求出$a^p$在模$m$意义下的值，当$p$很大的时候，我们只需先求出$\phi(m)$，然后用快速幂求出$a^{p \bmod \phi(m)}$即可。

下面，假定$m=10^9+7$。

那么，下面的任务就是求出$\phi(m)$。

### 欧拉函数

对$\forall n \in N^*$，欧拉函数$\phi(n)$的值为小于$n$的正整数中与$n$互质的数的数目。

而欧拉函数存在解析式：
$$
\phi(n) = n \prod_{p}(1 - \frac 1 p)
$$
其中，$p$为$n$的质因子。

证明从略，会用就行。

但还是简单说一说，显然有：
$$
\phi(p^k) = p^k - p ^ {k-1}
$$
其中，$p$为素数。因为$p^k$与所有除$p$的倍数之外的数都互质。故只需从总数中减去$p$的倍数的个数即可。

而由中国剩余定理又可证出：
$$
\phi(ab) = \phi(a)\phi(b)
$$
对$n$进行素因子分解即可。

所以，可以这样实现欧拉函数：

```c++
ll Euler(ll n)
{
  int res = n;
  for (int i = 2; i * i <= n; i++)
    if (n % i == 0) {
      res = res - res / i;
      while(n % i == 0) {
        n = n / i;
      }
    }
  if (n > 1)
    res = res - res / n;
  return res;
}
```

这样求出$\phi(m)$即可。

但是，**这样真的有必要吗？**

如果你尝试了一下，会发现在上述假设条件下（也即$m=10^9+7$）时，$a^{\phi(m)} \bmod m = 1$。

而事实上，我们有**欧拉定理**。

### 欧拉定理

若$a, p \in N^*$，$(a, p) = 1$，则有：
$$
a^{\phi(p)} \equiv 1 \pmod p
$$
而事实上，$10^9+7​$为一个质数，故$\forall a​$，$(a, p) = 1​$。

而又有：
$$
a^p \equiv a^{p \bmod \phi(m) + \phi(m)} \equiv a ^ {p \bmod \phi(m)} \cdot a ^ {\phi(m)} \\
\equiv a^{p \bmod \phi(m)} \pmod m
$$
故事实上，只需用快速幂求出$a^{p \bmod \phi(m)}$在模$m$意义下的值即可。

顺带一提，$\phi(10^9+7) = 10^9+6​$。